<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Layers and Low Coupling на примере конфига и транспорта - Patterns</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-14213fa4.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-d959ff8c.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Patterns</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="nodejs-слои-и-слабое-зацепление-на-примере-конфигурации-и-транспорта"><a class="header" href="#nodejs-слои-и-слабое-зацепление-на-примере-конфигурации-и-транспорта">Node.js: Слои и Слабое Зацепление на примере конфигурации и транспорта</a></h1>
<h2 id="обзор"><a class="header" href="#обзор">Обзор</a></h2>
<p>Эта лекция посвящена архитектуре Node.js приложений с акцентом на разделение по слоям (Layers) и принцип слабого зацепления (Low Coupling). Мы рассмотрим практические примеры рефакторинга, включая вынос конфигурации из приложения, абстрагирование транспортных слоев (HTTP и WebSocket) и применение принципа инъекции зависимостей (Dependency Injection) через различные механизмы.</p>
<p><strong>Основные темы:</strong></p>
<ul>
<li>Вынос конфигурации в отдельный модуль</li>
<li>Абстрагирование транспортов</li>
<li>Слабое зацепление модулей</li>
<li>Инъекция зависимостей через замыкания</li>
<li>Отказ от кастомного лоадера в пользу CommonJS</li>
</ul>
<hr>
<h2 id="часть-1-вынос-конфигурации-из-приложения"><a class="header" href="#часть-1-вынос-конфигурации-из-приложения">Часть 1: Вынос конфигурации из приложения</a></h2>
<h3 id="проблема-конфигурация-распределена-по-коду"><a class="header" href="#проблема-конфигурация-распределена-по-коду">Проблема: Конфигурация распределена по коду</a></h3>
<p>Раньше конфигурация была встроена прямо в код приложения. Это создавало проблемы:</p>
<ul>
<li>Сильное зацепление (tight coupling) между модулями и конфигурацией</li>
<li>Сложность тестирования</li>
<li>Невозможность легко изменять параметры</li>
<li>Модули импортируют конфигурацию повсеместно</li>
</ul>
<h3 id="решение-централизованная-конфигурация"><a class="header" href="#решение-централизованная-конфигурация">Решение: Централизованная конфигурация</a></h3>
<p>Все настройки выносятся в один файл конфигурации (например, <code>config.js</code>).</p>
<h4 id="пример-структуры-конфига"><a class="header" href="#пример-структуры-конфига">Пример структуры конфига</a></h4>
<pre><code class="language-javascript">// config.js
'use strict';

module.exports = {
  // Порт для отдачи статики
  static: {
    port: 8000
  },

  // Порт для API
  api: {
    port: 8001,
    transport: 'http' // или 'ws' для WebSocket
  },

  // Настройки Sandbox для изоляции прикладного кода
  sandbox: {
    timeout: 5000,
    displayErrors: false
  },

  // Подключение к базе данных
  db: {
    host: 'localhost',
    port: 5432,
    database: 'application',
    user: 'user',
    password: 'password'
  }
};
</code></pre>
<h3 id="принцип-единственной-точки-входа"><a class="header" href="#принцип-единственной-точки-входа">Принцип единственной точки входа</a></h3>
<p><strong>Важно:</strong> Конфиг должен импортироваться <strong>только в одном месте</strong> — в точке входа приложения (<code>main.js</code>).</p>
<pre><code class="language-javascript">// main.js
'use strict';

const config = require('./config.js');

// Дальше конфиг передается через зависимости,
// а не импортируется повсеместно
</code></pre>
<p><strong>Почему это важно:</strong></p>
<ul>
<li>Централизованное управление конфигурацией</li>
<li>Легко отследить, где и как используются настройки</li>
<li>Упрощается тестирование (можно подменить конфиг)</li>
<li>Снижается зацепление между модулями</li>
</ul>
<hr>
<h2 id="часть-2-инъекция-зависимостей-через-замыкания"><a class="header" href="#часть-2-инъекция-зависимостей-через-замыкания">Часть 2: Инъекция зависимостей через замыкания</a></h2>
<h3 id="концепция"><a class="header" href="#концепция">Концепция</a></h3>
<p>Вместо импорта конфигурации в каждом модуле, мы <strong>инжектируем</strong> нужные части конфигурации через замыкания (closures).</p>
<h3 id="пример-1-инъекция-настроек-в-sandbox-loader"><a class="header" href="#пример-1-инъекция-настроек-в-sandbox-loader">Пример 1: Инъекция настроек в Sandbox loader</a></h3>
<p><strong>До рефакторинга:</strong></p>
<pre><code class="language-javascript">// loader.js
'use strict';

const config = require('./config.js'); // Плохо: импорт конфига

module.exports = (filename) =&gt; {
  const timeout = config.sandbox.timeout;
  // ... код
};
</code></pre>
<p><strong>После рефакторинга:</strong></p>
<pre><code class="language-javascript">// loader.js
'use strict';

// Экспортируем функцию, которая принимает options
module.exports = (options) =&gt; {
  // Возвращаем функцию-загрузчик
  return (filename) =&gt; {
    const { timeout } = options; // options попадает в замыкание

    const sandbox = {
      console,
      setTimeout,
      // ... остальные API
    };

    const context = vm.createContext(sandbox);
    // ... код запуска в sandbox
  };
};
</code></pre>
<p><strong>Использование в main.js:</strong></p>
<pre><code class="language-javascript">// main.js
const config = require('./config.js');
const createLoader = require('./loader.js');

// Передаем только нужную часть конфига
const loader = createLoader(config.sandbox);

// Теперь loader содержит настройки в замыкании
</code></pre>
<p><strong>Преимущества:</strong></p>
<ul>
<li>Модуль <code>loader.js</code> не знает про существование файла <code>config.js</code></li>
<li>Настройки попадают в замыкание и доступны внутри функции</li>
<li>Модуль получает <strong>только то, что ему нужно</strong>, а не весь конфиг</li>
</ul>
<h3 id="пример-2-инъекция-настроек-базы-данных"><a class="header" href="#пример-2-инъекция-настроек-базы-данных">Пример 2: Инъекция настроек базы данных</a></h3>
<pre><code class="language-javascript">// db.js
'use strict';

const pg = require('pg');

// Экспортируем функцию высшего порядка
module.exports = (options) =&gt; {
  // Создаем пул подключений с переданными настройками
  const pool = new pg.Pool(options);

  // Возвращаем функцию для создания CRUD операций
  const crud = (pool) =&gt; {
    return (tableName) =&gt; {
      return {
        async create(record) {
          const keys = Object.keys(record).join(', ');
          const values = Object.values(record);
          const params = values.map((_, i) =&gt; `$${i + 1}`).join(', ');
          const sql = `INSERT INTO ${tableName} (${keys}) VALUES (${params})`;
          const result = await pool.query(sql, values);
          return result.rows[0];
        },

        async read(id) {
          const sql = `SELECT * FROM ${tableName} WHERE id = $1`;
          const result = await pool.query(sql, [id]);
          return result.rows[0];
        },

        async update(id, record) {
          const keys = Object.keys(record);
          const values = Object.values(record);
          const set = keys.map((key, i) =&gt; `${key} = $${i + 2}`).join(', ');
          const sql = `UPDATE ${tableName} SET ${set} WHERE id = $1`;
          await pool.query(sql, [id, ...values]);
        },

        async delete(id) {
          const sql = `DELETE FROM ${tableName} WHERE id = $1`;
          await pool.query(sql, [id]);
        }
      };
    };
  };

  // Вызываем crud с пулом и возвращаем результат
  return crud(pool);
};
</code></pre>
<p><strong>Использование:</strong></p>
<pre><code class="language-javascript">// main.js
const config = require('./config.js');
const db = require('./db.js');

// Инжектируем настройки БД
const createCrud = db(config.db);

// Создаем CRUD для конкретной таблицы
const usersCrud = createCrud('users');

// Используем
await usersCrud.create({ name: 'John', email: 'john@example.com' });
</code></pre>
<p><strong>Цепочка вызовов:</strong></p>
<ol>
<li><code>db(config.db)</code> — передаем настройки, создаем пул, возвращаем функцию <code>crud</code></li>
<li><code>createCrud('users')</code> — передаем имя таблицы, возвращаем объект с методами CRUD</li>
<li>Пул и имя таблицы находятся в замыкании</li>
</ol>
<hr>
<h2 id="часть-3-инъекция-логгера"><a class="header" href="#часть-3-инъекция-логгера">Часть 3: Инъекция логгера</a></h2>
<h3 id="проблема-использования-глобального-console"><a class="header" href="#проблема-использования-глобального-console">Проблема использования глобального console</a></h3>
<p>Во многих модулях используется глобальный объект <code>console</code>, который:</p>
<ul>
<li>Невозможно переопределить или подменить</li>
<li>Не позволяет централизованно управлять логированием</li>
<li>Усложняет тестирование</li>
</ul>
<h3 id="решение-инъекция-кастомного-логгера"><a class="header" href="#решение-инъекция-кастомного-логгера">Решение: Инъекция кастомного логгера</a></h3>
<pre><code class="language-javascript">// logger.js
'use strict';

const pino = require('pino');

const logger = pino({
  level: 'info',
  transport: {
    target: 'pino-pretty',
    options: {
      colorize: true
    }
  }
});

// Создаем обертку с интерфейсом console
module.exports = {
  log: (...args) =&gt; logger.info(...args),
  error: (...args) =&gt; logger.error(...args),
  warn: (...args) =&gt; logger.warn(...args),
  debug: (...args) =&gt; logger.debug(...args),
};
</code></pre>
<p><strong>Использование в транспорте:</strong></p>
<pre><code class="language-javascript">// transport/ws.js
'use strict';

const { WebSocket } = require('ws');

module.exports = (routing, port, console) =&gt; {
  const ws = new WebSocket.Server({ port });

  ws.on('connection', (connection) =&gt; {
    console.log('WebSocket client connected'); // Используем инжектированный логгер

    connection.on('message', async (message) =&gt; {
      const { method, args } = JSON.parse(message);
      console.log(`Call: ${method}`, args);

      const handler = routing[method];
      if (!handler) {
        console.error(`Method not found: ${method}`);
        return;
      }

      const result = await handler(...args);
      connection.send(JSON.stringify(result));
    });
  });

  console.log(`WebSocket server on port ${port}`);
};
</code></pre>
<p><strong>В main.js:</strong></p>
<pre><code class="language-javascript">// main.js
const logger = require('./logger.js');
const transport = require('./transport/ws.js');

// Инжектируем логгер в транспорт
transport(routing, config.api.port, logger);
</code></pre>
<p><strong>Альтернатива — перекрытие имени:</strong></p>
<pre><code class="language-javascript">// static.js
module.exports = (path, port, console) =&gt; {
  // console теперь указывает на переданный логгер,
  // а не на глобальный объект

  const server = http.createServer((req, res) =&gt; {
    console.log(`${req.method} ${req.url}`);
    // ...
  });

  server.listen(port);
  console.log(`Static server on port ${port}`);
};
</code></pre>
<hr>
<h2 id="часть-4-абстрагирование-транспортов"><a class="header" href="#часть-4-абстрагирование-транспортов">Часть 4: Абстрагирование транспортов</a></h2>
<h3 id="цель"><a class="header" href="#цель">Цель</a></h3>
<p>Сделать приложение независимым от конкретного транспорта (HTTP или WebSocket). Переключение транспорта должно происходить изменением <strong>одного параметра в конфигурации</strong>.</p>
<h3 id="структура-папки-transport"><a class="header" href="#структура-папки-transport">Структура папки transport</a></h3>
<pre><code>transport/
├── http.js    # HTTP транспорт
└── ws.js      # WebSocket транспорт
</code></pre>
<h3 id="контракт-транспорта"><a class="header" href="#контракт-транспорта">Контракт транспорта</a></h3>
<p>Оба транспорта должны экспортировать функцию с одинаковой сигнатурой:</p>
<pre><code class="language-javascript">module.exports = (routing, port, console) =&gt; {
  // Инициализация транспорта
  // ...
};
</code></pre>
<p><strong>Параметры:</strong></p>
<ul>
<li><code>routing</code> — объект с методами API (маршрутизация)</li>
<li><code>port</code> — порт для запуска сервера</li>
<li><code>console</code> — логгер для вывода информации</li>
</ul>
<h3 id="реализация-http-транспорта"><a class="header" href="#реализация-http-транспорта">Реализация HTTP транспорта</a></h3>
<pre><code class="language-javascript">// transport/http.js
'use strict';

const http = require('http');

module.exports = (routing, port, console) =&gt; {
  const HEADERS = {
    'Content-Type': 'application/json',
    'Access-Control-Allow-Origin': '*',
    'Access-Control-Allow-Methods': 'POST, OPTIONS',
    'Access-Control-Allow-Headers': 'Content-Type',
  };

  const server = http.createServer(async (req, res) =&gt; {
    // Обработка CORS preflight
    if (req.method === 'OPTIONS') {
      res.writeHead(200, HEADERS);
      res.end();
      return;
    }

    // Парсинг URL: /api/interfaceName/methodName
    const url = req.url.split('/');
    const interfaceName = url[2];
    const methodName = url[3];

    console.log(`HTTP Call: ${interfaceName}.${methodName}`);

    // Получаем тело запроса
    let body = '';
    req.on('data', chunk =&gt; {
      body += chunk.toString();
    });

    req.on('end', async () =&gt; {
      const args = JSON.parse(body);
      const method = routing[methodName];

      if (!method) {
        res.writeHead(404, HEADERS);
        res.end(JSON.stringify({ error: 'Method not found' }));
        return;
      }

      try {
        const result = await method(...args);
        res.writeHead(200, HEADERS);
        res.end(JSON.stringify(result));
      } catch (error) {
        console.error(error);
        res.writeHead(500, HEADERS);
        res.end(JSON.stringify({ error: error.message }));
      }
    });
  });

  server.listen(port);
  console.log(`HTTP API server on port ${port}`);
};
</code></pre>
<h3 id="реализация-websocket-транспорта"><a class="header" href="#реализация-websocket-транспорта">Реализация WebSocket транспорта</a></h3>
<pre><code class="language-javascript">// transport/ws.js
'use strict';

const { WebSocketServer } = require('ws');

module.exports = (routing, port, console) =&gt; {
  const wss = new WebSocketServer({ port });

  wss.on('connection', (connection) =&gt; {
    console.log('WebSocket client connected');

    connection.on('message', async (message) =&gt; {
      const packet = JSON.parse(message);
      const { method, args } = packet;

      console.log(`WS Call: ${method}`, args);

      const handler = routing[method];

      if (!handler) {
        console.error(`Method not found: ${method}`);
        connection.send(JSON.stringify({ error: 'Method not found' }));
        return;
      }

      try {
        const result = await handler(...args);
        connection.send(JSON.stringify({ result }));
      } catch (error) {
        console.error(error);
        connection.send(JSON.stringify({ error: error.message }));
      }
    });

    connection.on('close', () =&gt; {
      console.log('WebSocket client disconnected');
    });
  });

  console.log(`WebSocket API server on port ${port}`);
};
</code></pre>
<h3 id="динамическая-загрузка-транспорта-в-mainjs"><a class="header" href="#динамическая-загрузка-транспорта-в-mainjs">Динамическая загрузка транспорта в main.js</a></h3>
<pre><code class="language-javascript">// main.js
'use strict';

const config = require('./config.js');
const logger = require('./logger.js');

// Динамически загружаем транспорт из конфига
const transportName = config.api.transport; // 'http' или 'ws'
const transport = require(`./transport/${transportName}.js`);

// Загружаем API (routing)
const routing = {};
const apiPath = './api';
const files = fs.readdirSync(apiPath);

for (const file of files) {
  const modulePath = path.join(apiPath, file);
  const methods = require(modulePath);
  Object.assign(routing, methods);
}

// Запускаем транспорт с инжекцией зависимостей
transport(routing, config.api.port, logger);
</code></pre>
<p><strong>Переключение транспорта:</strong></p>
<pre><code class="language-javascript">// config.js
module.exports = {
  api: {
    port: 8001,
    transport: 'http' // Меняем на 'ws' для WebSocket
  }
};
</code></pre>
<hr>
<h2 id="часть-5-абстрагирование-транспорта-на-клиенте"><a class="header" href="#часть-5-абстрагирование-транспорта-на-клиенте">Часть 5: Абстрагирование транспорта на клиенте</a></h2>
<h3 id="цель-1"><a class="header" href="#цель-1">Цель</a></h3>
<p>Клиентское приложение должно уметь работать с разными транспортами без изменения бизнес-логики.</p>
<h3 id="scaffold--динамическое-создание-api"><a class="header" href="#scaffold--динамическое-создание-api">Scaffold — динамическое создание API</a></h3>
<p><strong>Идея:</strong> На клиенте мы создаем прокси-объект, который имитирует серверное API. Вызов методов автоматически превращается в сетевые запросы.</p>
<pre><code class="language-javascript">// client.js
'use strict';

const scaffolds = {
  http: (url) =&gt; (structure) =&gt; {
    const api = {};
    for (const interfaceName in structure) {
      api[interfaceName] = {};
      const methods = structure[interfaceName];

      for (const methodName of methods) {
        api[interfaceName][methodName] = (...args) =&gt; {
          return fetch(`${url}/${interfaceName}/${methodName}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(args)
          }).then(res =&gt; res.json());
        };
      }
    }
    return api;
  },

  ws: (url) =&gt; (structure) =&gt; {
    const socket = new WebSocket(url);
    const api = {};
    const calls = new Map();
    let callId = 0;

    socket.addEventListener('message', (event) =&gt; {
      const packet = JSON.parse(event.data);
      const { id, result, error } = packet;
      const { resolve, reject } = calls.get(id);

      if (error) reject(new Error(error));
      else resolve(result);

      calls.delete(id);
    });

    for (const interfaceName in structure) {
      api[interfaceName] = {};
      const methods = structure[interfaceName];

      for (const methodName of methods) {
        api[interfaceName][methodName] = (...args) =&gt; {
          return new Promise((resolve, reject) =&gt; {
            const id = callId++;
            calls.set(id, { resolve, reject });

            const packet = { id, method: methodName, args };
            socket.send(JSON.stringify(packet));
          });
        };
      }
    }

    return new Promise((resolve) =&gt; {
      socket.addEventListener('open', () =&gt; resolve(api));
    });
  }
};

// Определение транспорта по URL
const scaffold = (url, structure) =&gt; {
  const protocol = url.startsWith('ws://') || url.startsWith('wss://') ? 'ws' : 'http';
  const transport = scaffolds[protocol];
  return transport(url)(structure);
};

// Использование
const api = await scaffold('http://localhost:8001', {
  test: ['say']
});

// Вызов метода — прозрачно, без знания о транспорте
const result = await api.test.say('Hello');
console.log(result); // { status: 'OK' }
</code></pre>
<p><strong>Переключение транспорта:</strong></p>
<pre><code class="language-javascript">// Для HTTP
const api = await scaffold('http://localhost:8001', structure);

// Для WebSocket (меняем только URL)
const api = await scaffold('ws://localhost:8001', structure);
</code></pre>
<hr>
<h2 id="часть-6-слои-и-low-coupling"><a class="header" href="#часть-6-слои-и-low-coupling">Часть 6: Слои и Low Coupling</a></h2>
<h3 id="модель-isoosi-как-аналогия"><a class="header" href="#модель-isoosi-как-аналогия">Модель ISO/OSI как аналогия</a></h3>
<p>В сетевой модели ISO/OSI каждый слой взаимодействует <strong>только с соседними слоями</strong>. Например:</p>
<ul>
<li><strong>Application Layer</strong> на клиенте общается с <strong>Application Layer</strong> на сервере</li>
<li>Но физически данные проходят через все нижележащие слои (Transport, Network, Data Link, Physical)</li>
</ul>
<p><strong>Преимущества:</strong></p>
<ul>
<li>Каждый слой решает свою задачу</li>
<li>Слои не знают о деталях реализации других слоев</li>
<li>Можно заменить реализацию слоя без изменения других</li>
</ul>
<h3 id="применение-в-nodejs-приложении"><a class="header" href="#применение-в-nodejs-приложении">Применение в Node.js приложении</a></h3>
<pre><code>┌─────────────────────────────────────┐
│   Business Logic (API methods)      │  ← Прикладной уровень
├─────────────────────────────────────┤
│   Routing (метод → обработчик)      │  ← Уровень маршрутизации
├─────────────────────────────────────┤
│   Transport (HTTP / WebSocket)      │  ← Транспортный уровень
├─────────────────────────────────────┤
│   Infrastructure (Config, Logger)   │  ← Инфраструктурный уровень
└─────────────────────────────────────┘
</code></pre>
<p><strong>Принцип Low Coupling:</strong></p>
<ul>
<li>Бизнес-логика <strong>не знает</strong> про транспорт</li>
<li>Транспорт <strong>не знает</strong> про конфигурацию (получает только порт)</li>
<li>Маршрутизация <strong>не знает</strong> про логирование (получает логгер как зависимость)</li>
</ul>
<h3 id="пример-api-метод-не-зависит-от-транспорта"><a class="header" href="#пример-api-метод-не-зависит-от-транспорта">Пример: API метод не зависит от транспорта</a></h3>
<pre><code class="language-javascript">// api/test.js
'use strict';

module.exports = {
  async say(message) {
    console.log('Received message:', message);
    return { status: 'OK', echo: message };
  }
};
</code></pre>
<p><strong>Этот код работает одинаково при любом транспорте!</strong></p>
<hr>
<h2 id="часть-7-отказ-от-кастомного-лоадера"><a class="header" href="#часть-7-отказ-от-кастомного-лоадера">Часть 7: Отказ от кастомного лоадера</a></h2>
<h3 id="зачем-нужен-был-лоадер"><a class="header" href="#зачем-нужен-был-лоадер">Зачем нужен был лоадер?</a></h3>
<p>Кастомный лоадер позволял:</p>
<ul>
<li>Автоматически загружать модули из папки</li>
<li>Инжектировать зависимости в контекст модуля через VM sandbox</li>
<li>Изолировать прикладной код</li>
</ul>
<h3 id="переход-на-commonjs"><a class="header" href="#переход-на-commonjs">Переход на CommonJS</a></h3>
<p>В примере <strong>C</strong> лоадер удален, используется стандартный <code>require</code>.</p>
<p><strong>До (с лоадером):</strong></p>
<pre><code class="language-javascript">// main.js
const loader = require('./loader.js');

const apiPath = './api';
const files = fs.readdirSync(apiPath);

const api = {};
for (const file of files) {
  const modulePath = path.join(apiPath, file);
  const module = loader(modulePath);
  Object.assign(api, module);
}
</code></pre>
<p><strong>После (без лоадера):</strong></p>
<pre><code class="language-javascript">// main.js
const apiPath = './api';
const files = fs.readdirSync(apiPath);

const routing = {};
for (const file of files) {
  const modulePath = path.join(apiPath, file);
  const methods = require(modulePath);
  Object.assign(routing, methods);
}
</code></pre>
<p><strong>Последствия:</strong></p>
<ul>
<li>Код проще и понятнее</li>
<li>Минус один уровень абстракции</li>
<li>Модули выполняются в общем контексте Node.js</li>
<li>Но теряется изоляция</li>
</ul>
<hr>
<h2 id="часть-8-mime-типы-для-статического-сервера"><a class="header" href="#часть-8-mime-типы-для-статического-сервера">Часть 8: MIME-типы для статического сервера</a></h2>
<p>При отдаче статических файлов нужно указывать правильный <code>Content-Type</code>.</p>
<h3 id="словарь-mime-типов"><a class="header" href="#словарь-mime-типов">Словарь MIME-типов</a></h3>
<pre><code class="language-javascript">// static.js
const MIME_TYPES = {
  html: 'text/html; charset=UTF-8',
  js: 'application/javascript; charset=UTF-8',
  css: 'text/css',
  png: 'image/png',
  ico: 'image/x-icon',
  svg: 'image/svg+xml',
  json: 'application/json',
};
</code></pre>
<h3 id="использование"><a class="header" href="#использование">Использование</a></h3>
<pre><code class="language-javascript">// static.js
'use strict';

const http = require('http');
const fs = require('fs');
const path = require('path');

const MIME_TYPES = {
  html: 'text/html; charset=UTF-8',
  js: 'application/javascript; charset=UTF-8',
  css: 'text/css',
  png: 'image/png',
  ico: 'image/x-icon',
  svg: 'image/svg+xml',
};

const HEADERS = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Methods': 'GET, OPTIONS',
  'Access-Control-Allow-Headers': 'Content-Type',
};

module.exports = (staticPath, port, console) =&gt; {
  const server = http.createServer((req, res) =&gt; {
    const filePath = path.join(staticPath, req.url === '/' ? 'index.html' : req.url);
    const ext = path.extname(filePath).substring(1);
    const mimeType = MIME_TYPES[ext] || 'application/octet-stream';

    fs.readFile(filePath, (err, data) =&gt; {
      if (err) {
        res.writeHead(404, { 'Content-Type': 'text/plain' });
        res.end('Not Found');
        return;
      }

      res.writeHead(200, { ...HEADERS, 'Content-Type': mimeType });
      res.end(data);
    });
  });

  server.listen(port);
  console.log(`Static server on port ${port}`);
};
</code></pre>
<hr>
<h2 id="часть-9-способы-инъекции-зависимостей"><a class="header" href="#часть-9-способы-инъекции-зависимостей">Часть 9: Способы инъекции зависимостей</a></h2>
<p>В лекции были рассмотрены <strong>несколько способов</strong> внедрения зависимостей (Dependency Injection).</p>
<h3 id="способ-1-через-замыкание-closure-injection"><a class="header" href="#способ-1-через-замыкание-closure-injection">Способ 1: Через замыкание (Closure Injection)</a></h3>
<pre><code class="language-javascript">// module.js
module.exports = (dependency) =&gt; {
  return () =&gt; {
    // dependency доступна в замыкании
    dependency.doSomething();
  };
};

// main.js
const createModule = require('./module.js');
const module = createModule(someDependency);
</code></pre>
<p><strong>Плюсы:</strong></p>
<ul>
<li>Простота</li>
<li>Зависимость попадает в замыкание и всегда доступна</li>
<li>Нет глобального состояния</li>
</ul>
<h3 id="способ-2-через-require-singleton"><a class="header" href="#способ-2-через-require-singleton">Способ 2: Через require (Singleton)</a></h3>
<pre><code class="language-javascript">// logger.js
const pino = require('pino');
const logger = pino();
module.exports = logger;

// module1.js
const logger = require('./logger.js'); // Получает singleton
logger.info('Module 1');

// module2.js
const logger = require('./logger.js'); // Тот же экземпляр
logger.info('Module 2');
</code></pre>
<p><strong>Плюсы:</strong></p>
<ul>
<li>Автоматическое создание синглтона через кэш <code>require</code></li>
<li>Не нужно передавать зависимость явно</li>
</ul>
<p><strong>Минусы:</strong></p>
<ul>
<li>Сильное зацепление</li>
<li>Сложно тестировать (нужно чистить кэш <code>require</code>)</li>
</ul>
<h3 id="способ-3-через-конструктор-класса-constructor-injection"><a class="header" href="#способ-3-через-конструктор-класса-constructor-injection">Способ 3: Через конструктор класса (Constructor Injection)</a></h3>
<pre><code class="language-javascript">// Database.js
class Database {
  constructor(config, logger) {
    this.config = config;
    this.logger = logger;
    this.pool = new Pool(config);
  }

  async query(sql, params) {
    this.logger.info('Query:', sql);
    return this.pool.query(sql, params);
  }
}

module.exports = Database;

// main.js
const Database = require('./Database.js');
const db = new Database(config.db, logger);
</code></pre>
<p><strong>Плюсы:</strong></p>
<ul>
<li>Явная передача зависимостей</li>
<li>Легко тестировать (можно передать моки)</li>
<li>ООП подход</li>
</ul>
<h3 id="способ-4-через-sandbox-context-injection"><a class="header" href="#способ-4-через-sandbox-context-injection">Способ 4: Через Sandbox (Context Injection)</a></h3>
<pre><code class="language-javascript">// loader.js
const vm = require('vm');

module.exports = (filename, context) =&gt; {
  const code = fs.readFileSync(filename, 'utf8');
  const sandbox = { ...context, console, setTimeout };
  vm.runInContext(code, vm.createContext(sandbox));
};

// main.js
const context = {
  db: database,
  logger: logger,
  config: config
};

loader('./app.js', context);
</code></pre>
<p><strong>Плюсы:</strong></p>
<ul>
<li>Полная изоляция</li>
<li>Контроль над доступным API</li>
</ul>
<p><strong>Минусы:</strong></p>
<ul>
<li>Сложность</li>
<li>Производительность</li>
</ul>
<hr>
<h2 id="резюме"><a class="header" href="#резюме">Резюме</a></h2>
<h3 id="что-было-сделано-в-лекции"><a class="header" href="#что-было-сделано-в-лекции">Что было сделано в лекции:</a></h3>
<ol>
<li><strong>Вынесли конфигурацию</strong> в отдельный файл</li>
<li><strong>Создали единую точку входа</strong> для импорта конфига (main.js)</li>
<li><strong>Применили инъекцию зависимостей через замыкания</strong> для передачи:
<ul>
<li>Настроек Sandbox в loader</li>
<li>Настроек БД в db модуль</li>
<li>Логгера в транспорты</li>
<li>Порта в HTTP/WebSocket серверы</li>
</ul>
</li>
<li><strong>Абстрагировали транспорты:</strong>
<ul>
<li>Создали папку <code>transport/</code> с модулями <code>http.js</code> и <code>ws.js</code></li>
<li>Унифицировали контракт транспорта: <code>(routing, port, console) =&gt; {}</code></li>
<li>Реализовали динамическую загрузку транспорта из конфига</li>
</ul>
</li>
<li><strong>Реализовали scaffold на клиенте</strong> для автоматического создания API-прокси</li>
<li><strong>Показали переход от кастомного лоадера к CommonJS</strong></li>
<li><strong>Применили принцип Low Coupling:</strong>
<ul>
<li>Бизнес-логика не знает про транспорт</li>
<li>Транспорт не знает про конфигурацию</li>
<li>Модули получают только необходимые зависимости</li>
</ul>
</li>
</ol>
<h3 id="домашнее-задание"><a class="header" href="#домашнее-задание">Домашнее задание</a></h3>
<p><strong>Задание 5:</strong> Сделать подключаемый фреймворк (по аналогии с транспортом)</p>
<p><strong>Задание 7:</strong> Сделать подключаемый логгер (Pino или другой):</p>
<ul>
<li>Создать обертку, реализующую интерфейс <code>console</code></li>
<li>Инжектировать во все модули через замыкание</li>
<li>Обеспечить возможность переключения между нативным <code>console</code> и кастомным логгером</li>
</ul>
<h3 id="ключевые-принципы"><a class="header" href="#ключевые-принципы">Ключевые принципы</a></h3>
<p><strong>Low Coupling (Слабое зацепление):</strong></p>
<ul>
<li>Модули зависят от абстракций, а не от конкретных реализаций</li>
<li>Каждый модуль получает только то, что ему нужно</li>
<li>Изменения в одном модуле не затрагивают другие</li>
</ul>
<p><strong>Layered Architecture (Слоистая архитектура):</strong></p>
<ul>
<li>Четкое разделение ответственности между слоями</li>
<li>Слои взаимодействуют только через определенные интерфейсы</li>
<li>Возможность заменить реализацию слоя без изменения других</li>
</ul>
<p><strong>Dependency Injection (Инъекция зависимостей):</strong></p>
<ul>
<li>Зависимости передаются извне, а не создаются внутри модуля</li>
<li>Упрощает тестирование и переиспользование кода</li>
<li>Можно реализовать через замыкания, конструкторы, или контекст</li>
</ul>
<hr>
<h2 id="дополнительные-примеры"><a class="header" href="#дополнительные-примеры">Дополнительные примеры</a></h2>
<h3 id="пример-полный-цикл-запроса-через-слои"><a class="header" href="#пример-полный-цикл-запроса-через-слои">Пример: Полный цикл запроса через слои</a></h3>
<p><strong>Клиент (Browser):</strong></p>
<pre><code class="language-javascript">const api = await scaffold('http://localhost:8001', {
  test: ['say']
});

const result = await api.test.say('Hello');
console.log(result); // { status: 'OK', echo: 'Hello' }
</code></pre>
<p><strong>Сервер — Транспортный слой (HTTP):</strong></p>
<pre><code class="language-javascript">// transport/http.js
// Получает запрос POST /api/test/say
// Парсит тело: ["Hello"]
// Вызывает routing.say("Hello")
// Отправляет ответ: {"status": "OK", "echo": "Hello"}
</code></pre>
<p><strong>Сервер — Бизнес-логика:</strong></p>
<pre><code class="language-javascript">// api/test.js
module.exports = {
  async say(message) {
    return { status: 'OK', echo: message };
  }
};
</code></pre>
<p><strong>Поток данных:</strong></p>
<pre><code>Client → HTTP Request → Transport Layer → Routing → Business Logic
                                                          ↓
Client ← HTTP Response ← Transport Layer ← Return Value ←
</code></pre>
<h3 id="пример-переключение-с-http-на-websocket"><a class="header" href="#пример-переключение-с-http-на-websocket">Пример: Переключение с HTTP на WebSocket</a></h3>
<p><strong>Изменение на сервере:</strong></p>
<pre><code class="language-javascript">// config.js
module.exports = {
  api: {
    transport: 'ws' // Было: 'http'
  }
};
</code></pre>
<p><strong>Изменение на клиенте:</strong></p>
<pre><code class="language-javascript">// Было:
const api = await scaffold('http://localhost:8001', structure);

// Стало:
const api = await scaffold('ws://localhost:8001', structure);
</code></pre>
<p><strong>Бизнес-логика не меняется!</strong> Вызовы остаются прежними:</p>
<pre><code class="language-javascript">await api.test.say('Hello'); // Работает с любым транспортом
</code></pre>
<hr>
<h2 id="заключение"><a class="header" href="#заключение">Заключение</a></h2>
<p>Применение принципов <strong>Layers</strong> и <strong>Low Coupling</strong> позволяет создавать гибкие, легко тестируемые и поддерживаемые приложения. Инъекция зависимостей через замыкания — элегантный способ снизить зацепление в JavaScript/Node.js приложениях, сохраняя при этом простоту кода.</p>
<p>В следующих лекциях мы:</p>
<ul>
<li>Перейдем на ES Modules</li>
<li>Реализуем подключаемые фреймворки</li>
<li>Добавим работу с базами данных</li>
<li>Спроектируем API для мессенджера</li>
<li>Разработаем полноценное приложение на базе созданной инфраструктуры</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../week5/контрактное-программирование-lecture-notes.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../week5/adapter-pattern-lecture-notes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../week5/контрактное-программирование-lecture-notes.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../week5/adapter-pattern-lecture-notes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>


        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
