<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Характеристики и оптимизация для V8, SOLID - SRP, SoC - Patterns</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon-de23e50b.svg">
        <link rel="shortcut icon" href="../favicon-8114d1fc.png">
        <link rel="stylesheet" href="../css/variables-8adf115d.css">
        <link rel="stylesheet" href="../css/general-2459343d.css">
        <link rel="stylesheet" href="../css/chrome-ae938929.css">
        <link rel="stylesheet" href="../css/print-9e4910d8.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../fonts/fonts-9644e21d.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="mdbook-highlight-css" href="../highlight-493f70e1.css">
        <link rel="stylesheet" id="mdbook-tomorrow-night-css" href="../tomorrow-night-4c0ae647.css">
        <link rel="stylesheet" id="mdbook-ayu-highlight-css" href="../ayu-highlight-3fdfc3ac.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../searchindex-14213fa4.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc-d959ff8c.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="mdbook-body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="mdbook-sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("mdbook-sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="mdbook-sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="mdbook-sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="mdbook-page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="mdbook-menu-bar-hover-placeholder"></div>
                <div id="mdbook-menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="mdbook-sidebar-toggle" class="icon-button" for="mdbook-sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="mdbook-sidebar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"/></svg></span>
                        </label>
                        <button id="mdbook-theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="mdbook-theme-list">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M371.3 367.1c27.3-3.9 51.9-19.4 67.2-42.9L600.2 74.1c12.6-19.5 9.4-45.3-7.6-61.2S549.7-4.4 531.1 9.6L294.4 187.2c-24 18-38.2 46.1-38.4 76.1L371.3 367.1zm-19.6 25.4l-116-104.4C175.9 290.3 128 339.6 128 400c0 3.9 .2 7.8 .6 11.6c1.8 17.5-10.2 36.4-27.8 36.4H96c-17.7 0-32 14.3-32 32s14.3 32 32 32H240c61.9 0 112-50.1 112-112c0-2.5-.1-5-.2-7.5z"/></svg></span>
                        </button>
                        <ul id="mdbook-theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mdbook-theme-ayu">Ayu</button></li>
                        </ul>
                        <button id="mdbook-search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="mdbook-searchbar">
                            <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352c79.5 0 144-64.5 144-144s-64.5-144-144-144S64 128.5 64 208s64.5 144 144 144z"/></svg></span>
                        </button>
                    </div>

                    <h1 class="menu-title">Patterns</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <span class=fa-svg id="print-button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M128 0C92.7 0 64 28.7 64 64v96h64V64H354.7L384 93.3V160h64V93.3c0-17-6.7-33.3-18.7-45.3L400 18.7C388 6.7 371.7 0 354.7 0H128zM384 352v32 64H128V384 368 352H384zm64 32h32c17.7 0 32-14.3 32-32V256c0-35.3-28.7-64-64-64H64c-35.3 0-64 28.7-64 64v96c0 17.7 14.3 32 32 32H64v64c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V384zm-16-88c-13.3 0-24-10.7-24-24s10.7-24 24-24s24 10.7 24 24s-10.7 24-24 24z"/></svg></span>
                        </a>

                    </div>
                </div>

                <div id="mdbook-search-wrapper" class="hidden">
                    <form id="mdbook-searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="mdbook-searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="mdbook-searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <span class=fa-svg id="fa-spin"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M304 48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zm0 416c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM48 304c26.5 0 48-21.5 48-48s-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48zm464-48c0-26.5-21.5-48-48-48s-48 21.5-48 48s21.5 48 48 48s48-21.5 48-48zM142.9 437c18.7-18.7 18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zm0-294.2c18.7-18.7 18.7-49.1 0-67.9S93.7 56.2 75 75s-18.7 49.1 0 67.9s49.1 18.7 67.9 0zM369.1 437c18.7 18.7 49.1 18.7 67.9 0s18.7-49.1 0-67.9s-49.1-18.7-67.9 0s-18.7 49.1 0 67.9z"/></svg></span>
                            </div>
                        </div>
                    </form>
                    <div id="mdbook-searchresults-outer" class="searchresults-outer hidden">
                        <div id="mdbook-searchresults-header" class="searchresults-header"></div>
                        <ul id="mdbook-searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('mdbook-sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('mdbook-sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#mdbook-sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="mdbook-content" class="content">
                    <main>
                        <h1 id="паттерны-характеристики-кода-и-стратегии-оптимизации"><a class="header" href="#паттерны-характеристики-кода-и-стратегии-оптимизации">Паттерны: характеристики кода и стратегии оптимизации</a></h1>
<h2 id="обзор-лекции"><a class="header" href="#обзор-лекции">Обзор лекции</a></h2>
<p><strong>Тема:</strong> JavaScript, TypeScript — SOLID/SRP, SoC
<strong>Цель:</strong> Научиться писать код, который одновременно:</p>
<ul>
<li>Соответствует принципам SOLID и GRASP</li>
<li>Оптимизирован для виртуальной машины V8</li>
<li>Читабельный, надёжный и поддерживаемый</li>
</ul>
<hr>
<h2 id="1-введение-зачем-нужен-обзор-техник-перед-паттернами"><a class="header" href="#1-введение-зачем-нужен-обзор-техник-перед-паттернами">1. Введение: Зачем нужен обзор техник перед паттернами</a></h2>
<h3 id="основная-идея"><a class="header" href="#основная-идея">Основная идея</a></h3>
<p>Прежде чем изучать паттерны проектирования, необходимо понять:</p>
<ul>
<li>Какие возможности JavaScript и TypeScript мы будем использовать</li>
<li>Как разные парадигмы (процедурная, ООП, функциональная) применяются на практике</li>
<li>Как совместить принципы качественного кода с оптимизацией для V8</li>
</ul>
<h3 id="подход-к-балансу-характеристик-кода"><a class="header" href="#подход-к-балансу-характеристик-кода">Подход к балансу характеристик кода</a></h3>
<p>Мы стремимся сбалансировать:</p>
<ul>
<li><strong>Читаемость</strong> - код легко понять</li>
<li><strong>Надёжность</strong> - меньше ошибок</li>
<li><strong>Стабильность</strong> - предсказуемое поведение</li>
<li><strong>Модифицируемость</strong> - легко вносить изменения</li>
<li><strong>Тестируемость</strong> - простота покрытия тестами</li>
<li><strong>Производительность</strong> - эффективное выполнение</li>
</ul>
<hr>
<h2 id="2-анализ-плохого-кода-18-категорий-проблем"><a class="header" href="#2-анализ-плохого-кода-18-категорий-проблем">2. Анализ плохого кода: 18 категорий проблем</a></h2>
<h3 id="исходная-задача"><a class="header" href="#исходная-задача">Исходная задача</a></h3>
<p><strong>Задача:</strong> Обработать сырой датасет товаров с неконсистентными данными и извлечь цены.</p>
<p><strong>Проблемы входных данных:</strong></p>
<ul>
<li>Объекты с полями в разном порядке</li>
<li>Массивы вместо объектов</li>
<li>Смешанные типы данных (string и number)</li>
<li>Отсутствующие или переименованные поля (<code>price</code> vs <code>cost</code>)</li>
</ul>
<hr>
<h3 id="21-проблемы-оптимизации-v8"><a class="header" href="#21-проблемы-оптимизации-v8">2.1. Проблемы оптимизации V8</a></h3>
<h4 id="проблема-1-деоптимизация-виртуальной-машины"><a class="header" href="#проблема-1-деоптимизация-виртуальной-машины">Проблема 1: Деоптимизация виртуальной машины</a></h4>
<p><strong>Что:</strong> Полиморфный код постоянно меняет форму объектов и скрытые классы.</p>
<p><strong>Почему плохо:</strong></p>
<ul>
<li>V8 оптимизирует код на основе предположений о структуре объектов</li>
<li>Изменение формы объектов заставляет V8 отказываться от оптимизаций</li>
<li>Производительность падает</li>
</ul>
<p><strong>Ключевые концепции:</strong></p>
<ul>
<li><strong>Hidden Classes (скрытые классы)</strong> - внутреннее представление структуры объектов в V8</li>
<li><strong>Мегаморфный код</strong> - код, работающий с более чем 4 формами объектов</li>
</ul>
<h4 id="проблема-13-изменение-формы-объектов"><a class="header" href="#проблема-13-изменение-формы-объектов">Проблема 13: Изменение формы объектов</a></h4>
<p><strong>Антипаттерны:</strong></p>
<pre><code class="language-javascript">// Плохо: delete меняет форму объекта
const obj = { name: 'Item', price: 100 };
delete obj.price; // Форма изменилась!

// Плохо: добавление полей в разном порядке
const obj1 = { name: 'A', price: 10 };
const obj2 = { price: 20, name: 'B' }; // Другая форма!
</code></pre>
<p><strong>Решение:</strong></p>
<pre><code class="language-javascript">// Хорошо: всегда одна и та же форма
const obj1 = { name: 'A', price: 10 };
const obj2 = { name: 'B', price: 20 };
</code></pre>
<h4 id="проблема-14-дырявые-массивы"><a class="header" href="#проблема-14-дырявые-массивы">Проблема 14: Дырявые массивы</a></h4>
<p><strong>Что:</strong> Массивы с пропусками (holes) создаются при удалении элементов.</p>
<pre><code class="language-javascript">// Плохо
const arr = [1, 2, 3];
delete arr[1]; // [1, empty, 3] - дырявый массив
</code></pre>
<hr>
<h3 id="22-проблемы-читаемости-и-сложности"><a class="header" href="#22-проблемы-читаемости-и-сложности">2.2. Проблемы читаемости и сложности</a></h3>
<h4 id="проблема-2-избыток-if-ов-6-штук"><a class="header" href="#проблема-2-избыток-if-ов-6-штук">Проблема 2: Избыток if-ов (6 штук)</a></h4>
<p><strong>Почему плохо:</strong></p>
<ul>
<li>Высокая когнитивная нагрузка</li>
<li>Сложность тестирования (много ветвлений)</li>
<li>Трудно отследить логику</li>
</ul>
<p><strong>Решение:</strong> Использовать меньше условий через декомпозицию и изоляцию проверок.</p>
<h4 id="проблема-3-разнесённая-проверка-на-массив"><a class="header" href="#проблема-3-разнесённая-проверка-на-массив">Проблема 3: Разнесённая проверка на массив</a></h4>
<p><strong>Проблема:</strong></p>
<pre><code class="language-javascript">// Плохо: проверка в одном месте
if (!Array.isArray(data)) {
  // обработка объекта
}
// ... много кода ...
// обработка массива в другом месте
</code></pre>
<p><strong>Почему плохо:</strong> Глаза должны прыгать по коду, нарушается последовательность чтения.</p>
<h4 id="проблема-8-дупликация-кода"><a class="header" href="#проблема-8-дупликация-кода">Проблема 8: Дупликация кода</a></h4>
<p><strong>Примеры дупликации:</strong></p>
<ul>
<li>Повторяющиеся проверки (<code>options.converter</code>)</li>
<li>Похожие преобразования типов в разных местах</li>
</ul>
<hr>
<h3 id="23-проблемы-производительности"><a class="header" href="#23-проблемы-производительности">2.3. Проблемы производительности</a></h3>
<h4 id="проблема-4-неэффективная-деструктуризация-массива"><a class="header" href="#проблема-4-неэффективная-деструктуризация-массива">Проблема 4: Неэффективная деструктуризация массива</a></h4>
<pre><code class="language-javascript">// Плохо: создаёт итератор
const [, value] = data; // Пропускаем первый, берём второй

// Хорошо: прямой доступ
const value = data[1];
</code></pre>
<p><strong>Почему плохо:</strong> Деструктуризация массива создаёт итератор, что медленнее прямого доступа.</p>
<h4 id="проблема-12-array-как-tuple"><a class="header" href="#проблема-12-array-как-tuple">Проблема 12: Array как tuple</a></h4>
<p><strong>Проблема:</strong></p>
<pre><code class="language-javascript">// Плохо в JavaScript
const item = ['Book', 100]; // [name, price]
const [name, price] = item;
</code></pre>
<p><strong>Почему плохо:</strong></p>
<ul>
<li>Создание итератора при деструктуризации</li>
<li>Непонятно, что в каком индексе</li>
<li>В JavaScript объект предпочтительнее</li>
</ul>
<p><strong>Решение:</strong></p>
<pre><code class="language-javascript">// Хорошо
const item = { name: 'Book', price: 100 };
const { name, price } = item;
</code></pre>
<h4 id="проблема-14-closures-модифицирующие-внешний-scope"><a class="header" href="#проблема-14-closures-модифицирующие-внешний-scope">Проблема 14: Closures, модифицирующие внешний scope</a></h4>
<pre><code class="language-javascript">// Плохо
const out = [];
data.forEach(item =&gt; {
  out.push(process(item)); // Модификация внешней переменной
});

// Хорошо
const out = data.map(item =&gt; process(item));

// Ещё лучше (для V8)
const out = [];
for (let i = 0; i &lt; data.length; i++) {
  out.push(process(data[i]));
}
</code></pre>
<hr>
<h3 id="24-проблемы-типизации"><a class="header" href="#24-проблемы-типизации">2.4. Проблемы типизации</a></h3>
<h4 id="проблема-5-избыток-union-типов"><a class="header" href="#проблема-5-избыток-union-типов">Проблема 5: Избыток Union типов</a></h4>
<p><strong>Проблема:</strong></p>
<pre><code class="language-typescript">// Плохо: сложный Union
type Item = { name: string; price?: number } | { name?: string; price: number };
function getPrice(data: Item | ItemData): number | undefined | NaN {
  // ...
}
</code></pre>
<p><strong>Цель:</strong> Минимизировать Union типы через нормализацию данных.</p>
<h4 id="проблема-6-выходной-тип-number--undefined--nan"><a class="header" href="#проблема-6-выходной-тип-number--undefined--nan">Проблема 6: Выходной тип <code>number | undefined | NaN</code></a></h4>
<p><strong>Проблема:</strong> NaN в JavaScript ведёт себя странно (<code>NaN !== NaN</code>).</p>
<p><strong>Решение:</strong> Возвращать <code>number | undefined</code>, заменяя NaN на undefined.</p>
<pre><code class="language-typescript">// Плохо
return parseInt(value); // Может вернуть NaN

// Хорошо
const parsed = parseInt(value);
return isNaN(parsed) ? undefined : parsed;
</code></pre>
<hr>
<h3 id="25-проблемы-архитектуры"><a class="header" href="#25-проблемы-архитектуры">2.5. Проблемы архитектуры</a></h3>
<h4 id="проблема-9-слабые-контракты-weak-contracts"><a class="header" href="#проблема-9-слабые-контракты-weak-contracts">Проблема 9: Слабые контракты (Weak Contracts)</a></h4>
<p><strong>Суть:</strong> Сырые данные проникают глубоко в бизнес-логику.</p>
<p><strong>Решение:</strong> Изолировать сложность входных данных:</p>
<ol>
<li>На входе нормализовать данные</li>
<li>В бизнес-логике работать только с консистентными данными</li>
</ol>
<h4 id="проблема-10-mixed-responsibility-смешение-ответственностей"><a class="header" href="#проблема-10-mixed-responsibility-смешение-ответственностей">Проблема 10: Mixed Responsibility (Смешение ответственностей)</a></h4>
<p><strong>Функция делает слишком много:</strong></p>
<ul>
<li>Конвертирует сырые данные</li>
<li>Определяет типы</li>
<li>Нормализует данные</li>
<li>Преобразует массивы в объекты</li>
<li>Извлекает конкретное поле (price)</li>
</ul>
<p><strong>Принцип:</strong> Single Responsibility Principle (SRP) - одна функция = одна ответственность.</p>
<h4 id="проблема-11-inconsistent-return"><a class="header" href="#проблема-11-inconsistent-return">Проблема 11: Inconsistent Return</a></h4>
<p><strong>Проблема:</strong> Функция возвращает разные типы в разных ветках.</p>
<pre><code class="language-javascript">// Плохо: ESLint ругается
function getPrice(data) {
  if (!data) return undefined;
  if (typeof data === 'string') return NaN;
  return data.price;
}
</code></pre>
<hr>
<h3 id="26-стилистические-проблемы"><a class="header" href="#26-стилистические-проблемы">2.6. Стилистические проблемы</a></h3>
<h4 id="проблема-15-неявное-преобразование-типов"><a class="header" href="#проблема-15-неявное-преобразование-типов">Проблема 15: Неявное преобразование типов</a></h4>
<p><strong>Антипаттерны:</strong></p>
<pre><code class="language-javascript">// Приведение к строке
const str1 = '' + number;
const str2 = `${number}`;

// Приведение к числу
const num1 = +string;
const num2 = string * 1;
const num3 = string - 0;
const num4 = string / 1;
</code></pre>
<p><strong>Почему плохо:</strong> Повышает когнитивную нагрузку, неочевидно.</p>
<p><strong>Решение:</strong></p>
<pre><code class="language-javascript">// Явное преобразование
const str = String(number);
const num = Number(string);
const num2 = parseInt(string, 10);
const num3 = parseFloat(string);
</code></pre>
<h4 id="проблема-16-сравнение-с-автоприведением-типов"><a class="header" href="#проблема-16-сравнение-с-автоприведением-типов">Проблема 16: Сравнение с автоприведением типов</a></h4>
<p><strong>Правило:</strong> Всегда использовать строгое сравнение.</p>
<pre><code class="language-javascript">// Плохо
if (value == null) { }
if (a != b) { }

// Хорошо
if (value === null) { }
if (a !== b) { }
</code></pre>
<h4 id="проблема-17-последовательное-присвоение"><a class="header" href="#проблема-17-последовательное-присвоение">Проблема 17: Последовательное присвоение</a></h4>
<pre><code class="language-javascript">// Плохо
let a = b = c = 0;

// Хорошо
let a = 0;
let b = 0;
let c = 0;
</code></pre>
<h4 id="проблема-18-использование-var"><a class="header" href="#проблема-18-использование-var">Проблема 18: Использование var</a></h4>
<p><strong>Правило:</strong> Использовать <code>const</code> по умолчанию, <code>let</code> только при необходимости.</p>
<pre><code class="language-javascript">// Плохо
var x = 10;

// Хорошо
const x = 10;

// Если нужна мутация
let counter = 0;
counter++; // Но не менять тип!
</code></pre>
<p><strong>Важно:</strong> Если переменная объявлена через <code>let</code>:</p>
<ul>
<li>Не менять её тип (<code>number</code> → <code>string</code>)</li>
<li>Стараться не смешивать <code>float</code> и <code>integer</code></li>
</ul>
<hr>
<h2 id="3-рефакторинг-1-процедурный-стиль-с-разделением-ответственности"><a class="header" href="#3-рефакторинг-1-процедурный-стиль-с-разделением-ответственности">3. Рефакторинг №1: Процедурный стиль с разделением ответственности</a></h2>
<h3 id="основная-идея-1"><a class="header" href="#основная-идея-1">Основная идея</a></h3>
<p>Разделить функцию на две:</p>
<ul>
<li><code>normalizeItem()</code> - нормализует данные</li>
<li><code>getPrice()</code> - извлекает цену из нормализованных данных</li>
</ul>
<h3 id="ключевые-улучшения"><a class="header" href="#ключевые-улучшения">Ключевые улучшения</a></h3>
<h4 id="1-разделение-ответственностей-srp"><a class="header" href="#1-разделение-ответственностей-srp">1. Разделение ответственностей (SRP)</a></h4>
<pre><code class="language-javascript">// Плохо: одна функция делает всё
function getPrice(data, options) {
  // Проверки типов
  // Нормализация
  // Извлечение price
  // Конвертация типов
}

// Хорошо: две функции с чёткими ответственностями
function normalizeItem(data, options = {}) {
  // Только нормализация данных
  const isTuple = Array.isArray(data);
  const obj = isTuple ? { name: data[0], price: data[1] } : data;
  const { price, cost } = obj;
  const value = price ?? cost;

  const { converter } = options;
  const normalizedValue =
    typeof value === 'string' &amp;&amp; converter
      ? converter(value)
      : parseFloat(value);

  return { name: obj.name, price: normalizedValue };
}

function getPrice(item) {
  // Только извлечение price
  return item.price;
}
</code></pre>
<h4 id="2-использование-const-вместо-let"><a class="header" href="#2-использование-const-вместо-let">2. Использование const вместо let</a></h4>
<pre><code class="language-javascript">// Плохо
let price;
if (typeof value === 'string') {
  price = parseFloat(value);
} else {
  price = value;
}

// Хорошо
const price = typeof value === 'string' ? parseFloat(value) : value;
</code></pre>
<h4 id="3-уменьшение-if-ов"><a class="header" href="#3-уменьшение-if-ов">3. Уменьшение if-ов</a></h4>
<p><strong>Было:</strong> 6 if-ов
<strong>Стало:</strong> 3 тернарных оператора</p>
<p>Тернарные операторы проще читать, когда они однострочные.</p>
<h4 id="4-линейный-код"><a class="header" href="#4-линейный-код">4. Линейный код</a></h4>
<p>Код стал последовательным, без прыжков взгляда:</p>
<pre><code class="language-javascript">const isTuple = Array.isArray(data);
const obj = isTuple ? { name: data[0], price: data[1] } : data;
const { price, cost } = obj;
const value = price ?? cost;
// ... и так далее
</code></pre>
<h4 id="5-улучшение-типизации"><a class="header" href="#5-улучшение-типизации">5. Улучшение типизации</a></h4>
<p><strong>Было:</strong></p>
<pre><code class="language-typescript">type Item = { name?: string; price?: number } | ItemData;
</code></pre>
<p><strong>Стало:</strong></p>
<pre><code class="language-typescript">type RawItemTuple = [string, number | string];
type RawItemObject = { name: string; price?: number; cost?: number };
type RawItem = RawItemTuple | RawItemObject;

type NormalizedItem = { name: string; price: number };

function normalizeItem(data: RawItem, options?: Options): NormalizedItem {
  // ...
}
</code></pre>
<p><strong>Преимущества:</strong></p>
<ul>
<li>Чёткое разделение raw и normalized данных</li>
<li>Меньше Union типов во внутренней логике</li>
<li>Consistent return type</li>
</ul>
<h3 id="результаты-оптимизации"><a class="header" href="#результаты-оптимизации">Результаты оптимизации</a></h3>
<p><strong>Характеристики кода:</strong></p>
<ul>
<li>✅ Легче тестировать</li>
<li>✅ Легче читать</li>
<li>✅ Нет дупликации</li>
<li>✅ Меньше if-ов (3 тернарных вместо 6 if-ов)</li>
<li>✅ Изоляция проверок от бизнес-логики</li>
<li>✅ Применён SRP (Single Responsibility Principle)</li>
<li>✅ Применён SoC (Separation of Concerns)</li>
<li>✅ Consistent return</li>
<li>✅ Готов к inlining (V8 может встроить функции)</li>
</ul>
<hr>
<h2 id="4-рефакторинг-2-именованные-параметры"><a class="header" href="#4-рефакторинг-2-именованные-параметры">4. Рефакторинг №2: Именованные параметры</a></h2>
<h3 id="техника-именованных-параметров"><a class="header" href="#техника-именованных-параметров">Техника именованных параметров</a></h3>
<pre><code class="language-javascript">// Было: позиционные параметры
function normalizeItem(data, options) {
  // ...
}
normalizeItem(item, { converter: parseFloat });

// Стало: именованные параметры
function normalizeItem({ data, options = {} }) {
  // ...
}
normalizeItem({ data: item, options: { converter: parseFloat } });
</code></pre>
<h3 id="когда-использовать"><a class="header" href="#когда-использовать">Когда использовать</a></h3>
<p><strong>Плюсы именованных параметров:</strong></p>
<ul>
<li>Читаемость - видно, что передаётся</li>
<li>Гибкость - можно опускать/переставлять аргументы</li>
<li>Самодокументирование кода</li>
</ul>
<p><strong>Минусы:</strong></p>
<ul>
<li>Создаёт дополнительные обёртки (деструктуризация)</li>
<li>Немного медленнее для V8</li>
</ul>
<h3 id="рекомендация"><a class="header" href="#рекомендация">Рекомендация</a></h3>
<ul>
<li><strong>Высокоуровневый код:</strong> использовать именованные параметры (приоритет читаемости)</li>
<li><strong>Низкоуровневый код:</strong> использовать позиционные параметры (приоритет производительности)</li>
</ul>
<hr>
<h2 id="5-рефакторинг-3-классы-и-статические-фабрики"><a class="header" href="#5-рефакторинг-3-классы-и-статические-фабрики">5. Рефакторинг №3: Классы и статические фабрики</a></h2>
<h3 id="зачем-использовать-классы"><a class="header" href="#зачем-использовать-классы">Зачем использовать классы</a></h3>
<ul>
<li>Некоторые паттерны естественнее выражаются через ООП</li>
<li>Инкапсуляция данных</li>
<li>Использование <code>instanceof</code> для проверки типов</li>
<li>Мультипарадигменный подход</li>
</ul>
<h3 id="паттерн-статические-фабрики"><a class="header" href="#паттерн-статические-фабрики">Паттерн: Статические фабрики</a></h3>
<p><strong>Структура класса:</strong></p>
<pre><code class="language-javascript">class Item {
  constructor(name, price, options = {}) {
    const { converter } = options;
    this.name = name;
    this.price =
      typeof price === 'string' &amp;&amp; converter
        ? converter(price)
        : parseFloat(price);
  }

  // Фабрика для объектов
  static fromStruct({ name, price, cost, ...options }) {
    return new Item(name, price ?? cost, options);
  }

  // Фабрика для массивов (tuple)
  static fromTuple([name, price], options) {
    return new Item(name, price, options);
  }

  // Общая фабрика (Strategy выбора)
  static fromData(data, options = {}) {
    const factory = Array.isArray(data) ? Item.fromTuple : Item.fromStruct;
    return factory(data, options);
  }
}
</code></pre>
<h3 id="использование"><a class="header" href="#использование">Использование</a></h3>
<pre><code class="language-javascript">// Использование
const items = rawData.map(data =&gt; Item.fromData(data, { converter: parseFloat }));
const prices = items.map(item =&gt; item.price);
</code></pre>
<h3 id="преимущества-подхода"><a class="header" href="#преимущества-подхода">Преимущества подхода</a></h3>
<ol>
<li>
<p><strong>Декомпозиция:</strong> Каждая фабрика имеет одну ответственность</p>
<ul>
<li><code>fromStruct</code> - разобрать объект</li>
<li><code>fromTuple</code> - разобрать массив</li>
<li><code>fromData</code> - выбрать нужную фабрику</li>
</ul>
</li>
<li>
<p><strong>Strategy pattern:</strong> <code>fromData</code> выбирает стратегию на основе типа данных</p>
</li>
<li>
<p><strong>Приватность:</strong> Можно сделать поля приватными с геттерами</p>
</li>
</ol>
<pre><code class="language-javascript">class Item {
  #price; // Приватное поле

  constructor(name, price) {
    this.name = name;
    this.#price = price;
  }

  get price() {
    return this.#price;
  }
}
</code></pre>
<h3 id="подход-к-strategy"><a class="header" href="#подход-к-strategy">Подход к Strategy</a></h3>
<pre><code class="language-javascript">// Выбор фабрики из переменной
const factory = Array.isArray(data) ? Item.fromTuple : Item.fromStruct;
return factory(data, options);
</code></pre>
<p>Это начало паттерна Strategy - выбор алгоритма из коллекции на основе ключа/условия.</p>
<hr>
<h2 id="6-рефакторинг-4-функциональный-подход-с-замыканиями"><a class="header" href="#6-рефакторинг-4-функциональный-подход-с-замыканиями">6. Рефакторинг №4: Функциональный подход с замыканиями</a></h2>
<h3 id="идея"><a class="header" href="#идея">Идея</a></h3>
<p>Вместо хранения данных в полях объекта использовать замыкания (closures).</p>
<h3 id="реализация"><a class="header" href="#реализация">Реализация</a></h3>
<pre><code class="language-javascript">// Фабрика объектов с замыканиями
function item(name, price, options = {}) {
  const { converter } = options;
  const normalizedPrice =
    typeof price === 'string' &amp;&amp; converter
      ? converter(price)
      : parseFloat(price);

  // Данные в замыкании
  const finalName = name;
  const finalPrice = normalizedPrice;

  // Возвращаем объект с методами доступа
  return {
    getName: () =&gt; finalName,
    getPrice: () =&gt; finalPrice
  };
}

// Фабрики остаются похожими
function fromStruct({ name, price, cost, ...options }) {
  return item(name, price ?? cost, options);
}

function fromTuple([name, price], options) {
  return item(name, price, options);
}

function fromData(data, options = {}) {
  const factory = Array.isArray(data) ? fromTuple : fromStruct;
  return factory(data, options);
}
</code></pre>
<h3 id="использование-1"><a class="header" href="#использование-1">Использование</a></h3>
<pre><code class="language-javascript">const items = rawData.map(data =&gt; fromData(data));
const prices = items.map(item =&gt; item.getPrice());
</code></pre>
<h3 id="преимущества"><a class="header" href="#преимущества">Преимущества</a></h3>
<ol>
<li><strong>Иммутабельность:</strong> Данные нельзя модифицировать извне</li>
<li><strong>Инкапсуляция:</strong> Данные скрыты в замыкании</li>
<li><strong>Защита:</strong> Нет прямого доступа к переменным</li>
</ol>
<h3 id="результат"><a class="header" href="#результат">Результат</a></h3>
<pre><code class="language-javascript">console.log(item);
// { getName: [Function], getPrice: [Function] }
// Сами name и price не видны
</code></pre>
<hr>
<h2 id="7-рефакторинг-5-процедурный-код-финальная-версия"><a class="header" href="#7-рефакторинг-5-процедурный-код-финальная-версия">7. Рефакторинг №5: Процедурный код (финальная версия)</a></h2>
<h3 id="философия-процедурного-стиля"><a class="header" href="#философия-процедурного-стиля">Философия процедурного стиля</a></h3>
<p><strong>Почему процедурный?</strong></p>
<ul>
<li>Баланс между ФП и императивным стилем</li>
<li>Использование чистых функций</li>
<li>Не модифицируем state наружу, делаем return</li>
<li>Допускаются переменные (в отличие от чистого ФП)</li>
</ul>
<p><strong>Отличие от функционального:</strong></p>
<ul>
<li>В ФП не должно быть переменных - только expressions</li>
<li>В ФП функции очень маленькие (по 1 строке)</li>
<li>В процедурном допустимы if, for, переменные - более читаемо</li>
</ul>
<h3 id="принципы"><a class="header" href="#принципы">Принципы</a></h3>
<ol>
<li><strong>Чистые функции</strong> - не модифицируют внешний state</li>
<li><strong>Const по умолчанию</strong> - переменные только когда нужно</li>
<li><strong>Простые циклы</strong> - <code>for</code> вместо рекурсии</li>
<li><strong>Структуры данных</strong> - возвращаем объекты, а не храним в замыканиях</li>
</ol>
<h3 id="реализация-1"><a class="header" href="#реализация-1">Реализация</a></h3>
<pre><code class="language-javascript">// Всегда возвращаем объект одинаковой формы
function normalizeItem(data, options = {}) {
  const isTuple = Array.isArray(data);
  const obj = isTuple ? { name: data[0], price: data[1] } : data;
  const { name, price, cost } = obj;
  const value = price ?? cost;

  const { converter } = options;
  const normalizedPrice =
    typeof value === 'string' &amp;&amp; converter
      ? converter(value)
      : parseFloat(value);

  // Всегда одинаковая форма: { name: string, price: number }
  return { name, price: normalizedPrice };
}

function getPrice(item) {
  return item.price;
}
</code></pre>
<h3 id="результат-1"><a class="header" href="#результат-1">Результат</a></h3>
<pre><code class="language-javascript">const normalized = rawData.map(data =&gt; normalizeItem(data));
const prices = normalized.map(getPrice);

console.table(normalized);
// Все объекты имеют одинаковую форму { name, price }
</code></pre>
<h3 id="итоговые-характеристики"><a class="header" href="#итоговые-характеристики">Итоговые характеристики</a></h3>
<p>✅ <strong>Читаемость:</strong> последовательный код
✅ <strong>Производительность:</strong> одна форма объектов → V8 оптимизирует
✅ <strong>Тестируемость:</strong> чистые функции легко тестировать
✅ <strong>Модифицируемость:</strong> понятная структура
✅ <strong>Надёжность:</strong> consistent types</p>
<hr>
<h2 id="8-ключевые-принципы-и-выводы"><a class="header" href="#8-ключевые-принципы-и-выводы">8. Ключевые принципы и выводы</a></h2>
<h3 id="принцип-single-responsibility-srp"><a class="header" href="#принцип-single-responsibility-srp">Принцип Single Responsibility (SRP)</a></h3>
<p><strong>Определение:</strong> Каждая функция/класс должны иметь одну ответственность.</p>
<p><strong>Пример из лекции:</strong></p>
<ul>
<li><code>normalizeItem</code> - только нормализация</li>
<li><code>getPrice</code> - только извлечение цены</li>
<li><code>fromStruct</code> - только разбор объекта</li>
<li><code>fromTuple</code> - только разбор массива</li>
</ul>
<h3 id="принцип-separation-of-concerns-soc"><a class="header" href="#принцип-separation-of-concerns-soc">Принцип Separation of Concerns (SoC)</a></h3>
<p><strong>Определение:</strong> Разделение задач - каждый узел системы выполняет одну задачу.</p>
<p><strong>Применение:</strong></p>
<ul>
<li>Изолировать обработку сырых данных от бизнес-логики</li>
<li>Разделить raw и normalized данные</li>
<li>Логика проверок не проникает в бизнес-логику</li>
</ul>
<h3 id="weak-contracts-vs-strong-contracts"><a class="header" href="#weak-contracts-vs-strong-contracts">Weak Contracts vs Strong Contracts</a></h3>
<p><strong>Weak Contracts (плохо):</strong></p>
<pre><code class="language-javascript">// Бизнес-логика работает с сырыми данными
function businessLogic(rawData) {
  if (Array.isArray(rawData)) { /* ... */ }
  if (typeof rawData.price === 'string') { /* ... */ }
  // Проверки размазаны по всему коду
}
</code></pre>
<p><strong>Strong Contracts (хорошо):</strong></p>
<pre><code class="language-javascript">// Нормализация на входе
const normalized = rawData.map(normalizeItem);

// Бизнес-логика работает с чистыми данными
function businessLogic(normalizedData) {
  // Никаких проверок - данные уже консистентны
  return normalizedData.map(item =&gt; item.price * 1.2);
}
</code></pre>
<h3 id="оптимизация-для-v8"><a class="header" href="#оптимизация-для-v8">Оптимизация для V8</a></h3>
<p><strong>Правила:</strong></p>
<ol>
<li><strong>Одна форма объекта</strong> - всегда { name, price } в одном порядке</li>
<li><strong>Не менять форму</strong> - не использовать delete, не добавлять поля</li>
<li><strong>Не смешивать типы</strong> - в переменной всегда один тип</li>
<li><strong>Избегать дырявых массивов</strong> - не delete из массивов</li>
<li><strong>Const &gt; let &gt; var</strong> - предсказуемость для оптимизатора</li>
<li><strong>Меньше 4 форм</strong> - иначе мегаморфный код</li>
</ol>
<h3 id="баланс-характеристик"><a class="header" href="#баланс-характеристик">Баланс характеристик</a></h3>
<p>Код должен быть:</p>
<ul>
<li>✅ Читаемый</li>
<li>✅ Надёжный</li>
<li>✅ Стабильный</li>
<li>✅ Понятный</li>
<li>✅ Модифицируемый</li>
<li>✅ Тестируемый</li>
<li>✅ Достаточно оптимизированный</li>
</ul>
<p><strong>Не надо:</strong> Жертвовать всем ради максимальной производительности или максимальной красоты.</p>
<hr>
<h2 id="9-практические-рекомендации"><a class="header" href="#9-практические-рекомендации">9. Практические рекомендации</a></h2>
<h3 id="что-использовать"><a class="header" href="#что-использовать">Что использовать</a></h3>
<h4 id="-использовать-всегда"><a class="header" href="#-использовать-всегда">✅ Использовать всегда</a></h4>
<ul>
<li><code>const</code> по умолчанию</li>
<li>Строгое сравнение (<code>===</code>, <code>!==</code>)</li>
<li>Явное преобразование типов (<code>Number()</code>, <code>String()</code>)</li>
<li>Чистые функции</li>
<li>Consistent object shapes</li>
<li>Разделение raw и normalized данных</li>
</ul>
<h4 id="-использовать-осторожно"><a class="header" href="#-использовать-осторожно">⚠️ Использовать осторожно</a></h4>
<ul>
<li><code>let</code> - только если действительно нужна мутация</li>
<li>Тернарные операторы - только однострочные</li>
<li>Именованные параметры - в высокоуровневом коде</li>
<li>Классы - когда подходят паттерны ООП</li>
</ul>
<h4 id="-избегать"><a class="header" href="#-избегать">❌ Избегать</a></h4>
<ul>
<li><code>var</code></li>
<li><code>==</code> и <code>!=</code></li>
<li><code>delete</code> на объектах</li>
<li>Неявное приведение типов (<code>+str</code>, <code>str * 1</code>)</li>
<li>Последовательное присвоение (<code>a = b = c</code>)</li>
<li>Модификация аргументов функции</li>
<li>Closures, модифицирующие внешний scope</li>
<li>Деструктуризация массивов как tuples</li>
<li>Массивы с элементами разных типов</li>
<li>Изменение типа переменной</li>
</ul>
<h3 id="когда-использовать-разные-стили"><a class="header" href="#когда-использовать-разные-стили">Когда использовать разные стили</a></h3>
<div class="table-wrapper">
<table>
<thead>
<tr><th>Стиль</th><th>Когда использовать</th></tr>
</thead>
<tbody>
<tr><td><strong>Процедурный</strong></td><td>Основной стиль для прикладного кода. Баланс читаемости и производительности.</td></tr>
<tr><td><strong>ООП (классы)</strong></td><td>Паттерны, требующие инкапсуляции и полиморфизма. Статические фабрики.</td></tr>
<tr><td><strong>Функциональный</strong></td><td>Когда нужна иммутабельность и защита данных. Композиция функций.</td></tr>
</tbody>
</table>
</div>
<h3 id="subset-javascript"><a class="header" href="#subset-javascript">Subset JavaScript</a></h3>
<p><strong>Философия:</strong> Использовать подмножество возможностей JavaScript, а не всю мощь языка.</p>
<p><strong>Почему:</strong></p>
<ul>
<li>Повышает предсказуемость</li>
<li>Упрощает чтение кода</li>
<li>Помогает V8 оптимизировать</li>
<li>Снижает количество ошибок</li>
</ul>
<hr>
<h2 id="10-типичные-ошибки-и-как-их-избежать"><a class="header" href="#10-типичные-ошибки-и-как-их-избежать">10. Типичные ошибки и как их избежать</a></h2>
<h3 id="ошибка-1-переусложнение"><a class="header" href="#ошибка-1-переусложнение">Ошибка 1: Переусложнение</a></h3>
<pre><code class="language-javascript">// Плохо: использование всех возможностей JS
const price = options?.converter?.(value) ?? +value || parseFloat(value);

// Хорошо: простой и понятный код
const price = options.converter
  ? options.converter(value)
  : parseFloat(value);
</code></pre>
<h3 id="ошибка-2-игнорирование-формы-объектов"><a class="header" href="#ошибка-2-игнорирование-формы-объектов">Ошибка 2: Игнорирование формы объектов</a></h3>
<pre><code class="language-javascript">// Плохо: разные формы
const items = [
  { name: 'A', price: 10 },
  { price: 20, name: 'B' }, // Другой порядок полей!
  { name: 'C', cost: 30 }   // Другое поле!
];

// Хорошо: всегда одна форма
const normalizeItem = (raw) =&gt; ({
  name: raw.name,
  price: raw.price ?? raw.cost
});
const items = rawData.map(normalizeItem);
</code></pre>
<h3 id="ошибка-3-смешение-ответственностей"><a class="header" href="#ошибка-3-смешение-ответственностей">Ошибка 3: Смешение ответственностей</a></h3>
<pre><code class="language-javascript">// Плохо: функция делает всё
function processAndSave(rawData) {
  // Валидация
  // Нормализация
  // Бизнес-логика
  // Сохранение в БД
}

// Хорошо: разделение
function validate(data) { /* ... */ }
function normalize(data) { /* ... */ }
function process(data) { /* ... */ }
function save(data) { /* ... */ }

// Композиция
const result = save(process(normalize(validate(rawData))));
</code></pre>
<h3 id="ошибка-4-проверки-в-бизнес-логике"><a class="header" href="#ошибка-4-проверки-в-бизнес-логике">Ошибка 4: Проверки в бизнес-логике</a></h3>
<pre><code class="language-javascript">// Плохо
function calculateDiscount(item) {
  if (!item.price) return 0;
  if (typeof item.price === 'string') {
    item.price = parseFloat(item.price);
  }
  return item.price * 0.1;
}

// Хорошо: нормализация на входе
function calculateDiscount(item) {
  // item.price гарантированно number
  return item.price * 0.1;
}
</code></pre>
<hr>
<h2 id="11-связь-с-паттернами-проектирования"><a class="header" href="#11-связь-с-паттернами-проектирования">11. Связь с паттернами проектирования</a></h2>
<p>Эта лекция закладывает основу для изучения паттернов:</p>
<h3 id="strategy-начало-в-рефакторинге-3"><a class="header" href="#strategy-начало-в-рефакторинге-3">Strategy (начало в Рефакторинге №3)</a></h3>
<pre><code class="language-javascript">// Выбор стратегии на основе данных
const factory = Array.isArray(data) ? fromTuple : fromStruct;
return factory(data);
</code></pre>
<h3 id="factory-method"><a class="header" href="#factory-method">Factory Method</a></h3>
<pre><code class="language-javascript">// Статические фабрики - разновидность Factory
static fromStruct(data) { /* ... */ }
static fromTuple(data) { /* ... */ }
static fromData(data) { /* ... */ }
</code></pre>
<h3 id="solid-принципы"><a class="header" href="#solid-принципы">SOLID принципы</a></h3>
<ul>
<li><strong>S</strong> - Single Responsibility (разделение normalizeItem и getPrice)</li>
<li><strong>O</strong> - Open/Closed (фабрики можно расширять)</li>
<li><strong>L</strong> - Liskov Substitution (все фабрики возвращают совместимые объекты)</li>
<li><strong>I</strong> - Interface Segregation (минимальные интерфейсы)</li>
<li><strong>D</strong> - Dependency Inversion (options injection)</li>
</ul>
<hr>
<h2 id="12-резюме"><a class="header" href="#12-резюме">12. Резюме</a></h2>
<h3 id="главные-выводы"><a class="header" href="#главные-выводы">Главные выводы</a></h3>
<ol>
<li>
<p><strong>Баланс важнее крайностей</strong> - нужен компромисс между производительностью и читаемостью</p>
</li>
<li>
<p><strong>Разделяй и властвуй</strong> - декомпозиция улучшает все характеристики кода</p>
</li>
<li>
<p><strong>Изолируй сложность</strong> - проверки и нормализация на входе, чистая логика внутри</p>
</li>
<li>
<p><strong>Консистентность данных</strong> - одна форма объектов, predictable types</p>
</li>
<li>
<p><strong>Subset &gt; Full power</strong> - использовать простое подмножество JS, а не все возможности</p>
</li>
</ol>
<h3 id="практический-чеклист"><a class="header" href="#практический-чеклист">Практический чеклист</a></h3>
<p>При написании кода проверяйте:</p>
<ul>
<li><input disabled="" type="checkbox"> Используется <code>const</code> везде, где возможно</li>
<li><input disabled="" type="checkbox"> Строгое сравнение (<code>===</code>, <code>!==</code>)</li>
<li><input disabled="" type="checkbox"> Одна ответственность на функцию</li>
<li><input disabled="" type="checkbox"> Нет дупликации кода</li>
<li><input disabled="" type="checkbox"> Сырые данные нормализованы на входе</li>
<li><input disabled="" type="checkbox"> Объекты имеют одинаковую форму</li>
<li><input disabled="" type="checkbox"> Нет изменения формы объектов</li>
<li><input disabled="" type="checkbox"> Явное преобразование типов</li>
<li><input disabled="" type="checkbox"> Чистые функции (не модифицируют внешний state)</li>
<li><input disabled="" type="checkbox"> Consistent return types</li>
</ul>
<h3 id="дальнейшее-изучение"><a class="header" href="#дальнейшее-изучение">Дальнейшее изучение</a></h3>
<p><strong>Для углубления:</strong></p>
<ul>
<li>Оптимизации V8 (скрытые классы, inline caching)</li>
<li>SOLID и GRASP принципы</li>
<li>Паттерны проектирования на JavaScript/TypeScript</li>
<li>Функциональное программирование</li>
<li>TypeScript advanced types</li>
</ul>
<hr>
<h2 id="ссылки-и-материалы"><a class="header" href="#ссылки-и-материалы">Ссылки и материалы</a></h2>
<p><strong>Из лекции упоминались:</strong></p>
<ul>
<li>Блог Вячеслава Егорова (разработчик V8) - про оптимизации виртуальной машины</li>
<li>Статьи про скрытые классы и inline caching</li>
<li>Дополнительные видео и стримы по паттернам</li>
</ul>
<p><strong>Код из лекции:</strong></p>
<ul>
<li>Исходники всех примеров рефакторинга</li>
<li>Задачи для самостоятельной работы</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../week1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                            </a>

                            <a rel="next prefetch" href="../week1/grasp-principles-lecture-notes.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../week1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg></span>
                    </a>

                    <a rel="next prefetch" href="../week1/grasp-principles-lecture-notes.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M278.6 233.4c12.5 12.5 12.5 32.8 0 45.3l-160 160c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L210.7 256 73.4 118.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l160 160z"/></svg></span>
                    </a>
            </nav>

        </div>

        <template id=fa-eye><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M288 32c-80.8 0-145.5 36.8-192.6 80.6C48.6 156 17.3 208 2.5 243.7c-3.3 7.9-3.3 16.7 0 24.6C17.3 304 48.6 356 95.4 399.4C142.5 443.2 207.2 480 288 480s145.5-36.8 192.6-80.6c46.8-43.5 78.1-95.4 93-131.1c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C433.5 68.8 368.8 32 288 32zM432 256c0 79.5-64.5 144-144 144s-144-64.5-144-144s64.5-144 144-144s144 64.5 144 144zM288 192c0 35.3-28.7 64-64 64c-11.5 0-22.3-3-31.6-8.4c-.2 2.8-.4 5.5-.4 8.4c0 53 43 96 96 96s96-43 96-96s-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6z"/></svg></span></template>
        <template id=fa-eye-slash><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M38.8 5.1C28.4-3.1 13.3-1.2 5.1 9.2S-1.2 34.7 9.2 42.9l592 464c10.4 8.2 25.5 6.3 33.7-4.1s6.3-25.5-4.1-33.7L525.6 386.7c39.6-40.6 66.4-86.1 79.9-118.4c3.3-7.9 3.3-16.7 0-24.6c-14.9-35.7-46.2-87.7-93-131.1C465.5 68.8 400.8 32 320 32c-68.2 0-125 26.3-169.3 60.8L38.8 5.1zM223.1 149.5C248.6 126.2 282.7 112 320 112c79.5 0 144 64.5 144 144c0 24.9-6.3 48.3-17.4 68.7L408 294.5c5.2-11.8 8-24.8 8-38.5c0-53-43-96-96-96c-2.8 0-5.6 .1-8.4 .4c5.3 9.3 8.4 20.1 8.4 31.6c0 10.2-2.4 19.8-6.6 28.3l-90.3-70.8zm223.1 298L373 389.9c-16.4 6.5-34.3 10.1-53 10.1c-79.5 0-144-64.5-144-144c0-6.9 .5-13.6 1.4-20.2L83.1 161.5C60.3 191.2 44 220.8 34.5 243.7c-3.3 7.9-3.3 16.7 0 24.6c14.9 35.7 46.2 87.7 93 131.1C174.5 443.2 239.2 480 320 480c47.8 0 89.9-12.9 126.2-32.5z"/></svg></span></template>
        <template id=fa-copy><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M502.6 70.63l-61.25-61.25C435.4 3.371 427.2 0 418.7 0H255.1c-35.35 0-64 28.66-64 64l.0195 256C192 355.4 220.7 384 256 384h192c35.2 0 64-28.8 64-64V93.25C512 84.77 508.6 76.63 502.6 70.63zM464 320c0 8.836-7.164 16-16 16H255.1c-8.838 0-16-7.164-16-16L239.1 64.13c0-8.836 7.164-16 16-16h128L384 96c0 17.67 14.33 32 32 32h47.1V320zM272 448c0 8.836-7.164 16-16 16H63.1c-8.838 0-16-7.164-16-16L47.98 192.1c0-8.836 7.164-16 16-16H160V128H63.99c-35.35 0-64 28.65-64 64l.0098 256C.002 483.3 28.66 512 64 512h192c35.2 0 64-28.8 64-64v-32h-47.1L272 448z"/></svg></span></template>
        <template id=fa-play><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M73 39c-14.8-9.1-33.4-9.4-48.5-.9S0 62.6 0 80V432c0 17.4 9.4 33.4 24.5 41.9s33.7 8.1 48.5-.9L361 297c14.3-8.7 23-24.2 23-41s-8.7-32.2-23-41L73 39z"/></svg></span></template>
        <template id=fa-clock-rotate-left><span class=fa-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. --><path d="M75 75L41 41C25.9 25.9 0 36.6 0 57.9V168c0 13.3 10.7 24 24 24H134.1c21.4 0 32.1-25.9 17-41l-30.8-30.8C155 85.5 203 64 256 64c106 0 192 86 192 192s-86 192-192 192c-40.8 0-78.6-12.7-109.7-34.4c-14.5-10.1-34.4-6.6-44.6 7.9s-6.6 34.4 7.9 44.6C151.2 495 201.7 512 256 512c141.4 0 256-114.6 256-256S397.4 0 256 0C185.3 0 121.3 28.7 75 75zm181 53c-13.3 0-24 10.7-24 24V256c0 6.4 2.5 12.5 7 17l72 72c9.4 9.4 24.6 9.4 33.9 0s9.4-24.6 0-33.9l-65-65V152c0-13.3-10.7-24-24-24z"/></svg></span></template>

        <!-- Livereload script (if served using the cli tool) -->
        <script>
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>


        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr-ef4e11c1.min.js"></script>
        <script src="../mark-09e88c2c.min.js"></script>
        <script src="../searcher-c2a407aa.js"></script>

        <script src="../clipboard-1626706a.min.js"></script>
        <script src="../highlight-abc7f01d.js"></script>
        <script src="../book-a0b12cfe.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
